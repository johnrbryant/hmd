<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://assets-cdn.github.com/">
  <link rel="dns-prefetch" href="https://avatars0.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://avatars1.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://avatars2.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com/">
  <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com/">
  <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">



  <link crossorigin="anonymous" href="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/frameworks-2d2d4c150f7000385741c6b992b302689ecd172246c642890.css" integrity="sha256-LS1MFQ9wADhXQca5krMCaJ7NFyJGxkKJBOCBO+m87KY=" media="all" rel="stylesheet">
  <link crossorigin="anonymous" href="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/github-0522ae8d3b3bdc841d2f91f90efd5f1fd9040d910905674cd134c.css" integrity="sha256-BSKujTs73IQdL5H5Dv1fH9kEDZEJBWdM0TTO1Dpt/qY=" media="all" rel="stylesheet">
  
  
  <link crossorigin="anonymous" href="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/site-cfab053e93f0e27f4c63d4ff6b7957bd25f711667fe678e747f8a4d.css" integrity="sha256-z6sFPpPw4n9MY9T/a3lXvSX3EWZ/5njnR/ik2IxHs40=" media="all" rel="stylesheet">
  

  <meta name="viewport" content="width=device-width">
  
  <title>GitHub - mbjoseph/CARstan: Conditional autoregressive models in Stan</title>
  <link rel="search" type="application/opensearchdescription+xml" href="https://github.com/opensearch.xml" title="GitHub">
  <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
  <meta property="fb:app_id" content="1401488693436528">

    
    <meta content="https://avatars6.githubusercontent.com/u/2664564?v=4&amp;s=400" property="og:image"><meta content="GitHub" property="og:site_name"><meta content="object" property="og:type"><meta content="mbjoseph/CARstan" property="og:title"><meta content="https://github.com/mbjoseph/CARstan" property="og:url"><meta content="CARstan - Conditional autoregressive models in Stan" property="og:description">

  <link rel="assets" href="https://assets-cdn.github.com/">
  
  <meta name="pjax-timeout" content="1000">
  
  
  

  

  <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">
<meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">
    <meta name="google-analytics" content="UA-3769691-2">

<meta content="collector.githubapp.com" name="octolytics-host"><meta content="github" name="octolytics-app-id"><meta content="https://collector.githubapp.com/github-external/browser_event" name="octolytics-event-url"><meta content="C7E2:EE55:1300804:2015EF9:596B556E" name="octolytics-dimension-request_id"><meta content="iad" name="octolytics-dimension-region_edge"><meta content="iad" name="octolytics-dimension-region_render">





  <meta class="js-ga-set" name="dimension1" content="Logged Out">


  

      <meta name="hostname" content="github.com">
  <meta name="user-login" content="">

      <meta name="expected-hostname" content="github.com">
    <meta name="js-proxy-site-detection-payload" content="MDg4YTU1YTJjNDg3MGFlMGQxMDMyMTY4MWRmNzA4YTgyY2VlZmQxYTRmMmQ1ZDIzNWIxMWUwZmMxNzkxMDU1YXx7InJlbW90ZV9hZGRyZXNzIjoiNjIuMjI0LjE2Ny42OCIsInJlcXVlc3RfaWQiOiJDN0UyOkVFNTU6MTMwMDgwNDoyMDE1RUY5OjU5NkI1NTZFIiwidGltZXN0YW1wIjoxNTAwMjA2NDQ2LCJob3N0IjoiZ2l0aHViLmNvbSJ9">


  <meta name="html-safe-nonce" content="e99c3f02d1b3df39e1a2904d131cee9107a8e959">

  <meta http-equiv="x-pjax-version" content="f682644ce1bb9629b9d9d9bedf64801b">
  

      <link href="https://github.com/mbjoseph/CARstan/commits/master.atom" rel="alternate" title="Recent Commits to CARstan:master" type="application/atom+xml">

  <meta name="description" content="CARstan - Conditional autoregressive models in Stan">
  <meta name="go-import" content="github.com/mbjoseph/CARstan git https://github.com/mbjoseph/CARstan.git">

  <meta content="2664564" name="octolytics-dimension-user_id"><meta content="mbjoseph" name="octolytics-dimension-user_login"><meta content="66208070" name="octolytics-dimension-repository_id"><meta content="mbjoseph/CARstan" name="octolytics-dimension-repository_nwo"><meta content="true" name="octolytics-dimension-repository_public"><meta content="false" name="octolytics-dimension-repository_is_fork"><meta content="66208070" name="octolytics-dimension-repository_network_root_id"><meta content="mbjoseph/CARstan" name="octolytics-dimension-repository_network_root_nwo"><meta content="false" name="octolytics-dimension-repository_explore_github_marketplace_ci_cta_shown">


    


  <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">

  <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">

  <link rel="mask-icon" href="https://assets-cdn.github.com/pinned-octocat.svg" color="#000000">
  <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">

<meta name="theme-color" content="#1e2327">



  <meta name="request-id" content="C7E2:EE55:1300804:2015EF9:596B556E" data-pjax-transient="true"><meta name="selected-link" value="repo_source" data-pjax-transient="true"><meta content="/&lt;user-name&gt;/&lt;repo-name&gt;" data-pjax-transient="true" name="analytics-location"><link rel="canonical" href="https://github.com/mbjoseph/CARstan" data-pjax-transient="true"></head>

  <body class="logged-out env-production">
    



  <div class="position-relative js-header-wrapper ">
    <a href="#start-of-content" tabindex="1" class="px-2 py-4 show-on-focus js-skip-to-content">Skip to content</a>
    <div id="js-pjax-loader-bar" class="pjax-loader-bar"><div class="progress" style="width: 100%;"></div></div>

    
    
    



          <header class="site-header js-details-container Details" role="banner">
  <div class="site-nav-container">
    <a class="header-logo-invertocat" href="https://github.com/" aria-label="Homepage" data-ga-click="(Logged out) Header, go to homepage, icon:logo-wordmark">
      <svg aria-hidden="true" class="octicon octicon-mark-github" height="32" version="1.1" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
    </a>

    <button class="btn-link float-right site-header-toggle js-details-target" type="button" aria-label="Toggle navigation" aria-expanded="false">
      <svg aria-hidden="true" class="octicon octicon-three-bars" height="24" version="1.1" viewBox="0 0 12 16" width="18"><path fill-rule="evenodd" d="M11.41 9H.59C0 9 0 8.59 0 8c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zm0-4H.59C0 5 0 4.59 0 4c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zM.59 11H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1H.59C0 13 0 12.59 0 12c0-.59 0-1 .59-1z"></path></svg>
    </button>

    <div class="site-header-menu">
      <nav class="site-header-nav">
        <a href="https://github.com/features" class="js-selected-navigation-item nav-item" data-ga-click="Header, click, Nav menu - item:features" data-selected-links="/features /features/code-review /features/project-management /features/integrations /features">
          Features
</a>        <a href="https://github.com/business" class="js-selected-navigation-item nav-item" data-ga-click="Header, click, Nav menu - item:business" data-selected-links="/business /business/security /business/customers /business">
          Business
</a>        <a href="https://github.com/explore" class="js-selected-navigation-item nav-item" data-ga-click="Header, click, Nav menu - item:explore" data-selected-links="/explore /trending /trending/developers /stars /integrations /integrations/feature/code /integrations/feature/collaborate /integrations/feature/ship showcases showcases_search showcases_landing /explore">
          Explore
</a>            <a href="https://github.com/marketplace" class="js-selected-navigation-item nav-item" data-ga-click="Header, click, Nav menu - item:marketplace" data-selected-links=" /marketplace">
              Marketplace
</a>        <a href="https://github.com/pricing" class="js-selected-navigation-item nav-item" data-ga-click="Header, click, Nav menu - item:pricing" data-selected-links="/pricing /pricing/developer /pricing/team /pricing/business-hosted /pricing/business-enterprise /pricing">
          Pricing
</a>      </nav>

      <div class="site-header-actions">
          <div class="header-search scoped-search site-scoped-search js-site-search" role="search">
  <!-- '"` --><!-- </textarea></xmp> --><form accept-charset="UTF-8" action="/mbjoseph/CARstan/search" class="js-site-search-form" data-scoped-search-url="/mbjoseph/CARstan/search" data-unscoped-search-url="/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"></div>
    <label class="form-control header-search-wrapper js-chromeless-input-container">
        <a href="https://github.com/mbjoseph/CARstan" class="header-search-scope no-underline">This repository</a>
      <input class="form-control header-search-input js-site-search-focus js-site-search-field is-clearable" data-hotkey="s" name="q" placeholder="Search" aria-label="Search this repository" data-unscoped-placeholder="Search GitHub" data-scoped-placeholder="Search" autocapitalize="off" type="text">
        <input class="js-site-search-type-field" name="type" type="hidden">
    </label>
</form></div>


          <a class="text-bold site-header-link" href="https://github.com/login?return_to=%2Fmbjoseph%2FCARstan" data-ga-click="(Logged out) Header, clicked Sign in, text:sign-in">Sign in</a>
            <span class="text-gray">or</span>
            <a class="text-bold site-header-link" href="https://github.com/join?source=header-repo" data-ga-click="(Logged out) Header, clicked Sign up, text:sign-up">Sign up</a>
      </div>
    </div>
  </div>
</header>


  </div>

  <div id="start-of-content" class="show-on-focus"></div>

    <div id="js-flash-container">
</div>



  <div role="main">
        <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode">
    <div id="js-repo-pjax-container" data-pjax-container="">
      



    <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav">
      <div class="container repohead-details-container">

        <ul class="pagehead-actions">
  <li>
      <a href="https://github.com/login?return_to=%2Fmbjoseph%2FCARstan" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to watch a repository" rel="nofollow">
    <svg aria-hidden="true" class="octicon octicon-eye" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"></path></svg>
    Watch
  </a>
  <a class="social-count" href="https://github.com/mbjoseph/CARstan/watchers" aria-label="6 users are watching this repository">
    6
  </a>

  </li>

  <li>
      <a href="https://github.com/login?return_to=%2Fmbjoseph%2FCARstan" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to star a repository" rel="nofollow">
    <svg aria-hidden="true" class="octicon octicon-star" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74z"></path></svg>
    Star
  </a>

    <a class="social-count js-social-count" href="https://github.com/mbjoseph/CARstan/stargazers" aria-label="13 users starred this repository">
      13
    </a>

  </li>

  <li>
      <a href="https://github.com/login?return_to=%2Fmbjoseph%2FCARstan" class="btn btn-sm btn-with-count tooltipped tooltipped-n" aria-label="You must be signed in to fork a repository" rel="nofollow">
        <svg aria-hidden="true" class="octicon octicon-repo-forked" height="16" version="1.1" viewBox="0 0 10 16" width="10"><path fill-rule="evenodd" d="M8 1a1.993 1.993 0 0 0-1 3.72V6L5 8 3 6V4.72A1.993 1.993 0 0 0 2 1a1.993 1.993 0 0 0-1 3.72V6.5l3 3v1.78A1.993 1.993 0 0 0 5 15a1.993 1.993 0 0 0 1-3.72V9.5l3-3V4.72A1.993 1.993 0 0 0 8 1zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3 10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3-10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
        Fork
      </a>

    <a href="https://github.com/mbjoseph/CARstan/network" class="social-count" aria-label="6 users forked this repository">
      6
    </a>
  </li>
</ul>

        <h1 class="public ">
  <svg aria-hidden="true" class="octicon octicon-repo" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"></path></svg>
  <span class="author" itemprop="author"><a href="https://github.com/mbjoseph" class="url fn" rel="author">mbjoseph</a></span><!--
--><span class="path-divider">/</span><!--
--><strong itemprop="name"><a href="https://github.com/mbjoseph/CARstan" data-pjax="#js-repo-pjax-container">CARstan</a></strong>

</h1>

      </div>
      <div class="container">
        
<nav class="reponav js-repo-nav js-sidenav-container-pjax" itemscope="" itemtype="http://schema.org/BreadcrumbList" role="navigation" data-pjax="#js-repo-pjax-container">

  <span itemscope="" itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a href="https://github.com/mbjoseph/CARstan" class="js-selected-navigation-item reponav-item selected" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /mbjoseph/CARstan" itemprop="url">
      <svg aria-hidden="true" class="octicon octicon-code" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"></path></svg>
      <span itemprop="name">Code</span>
      <meta itemprop="position" content="1">
</a>  </span>

    <span itemscope="" itemtype="http://schema.org/ListItem" itemprop="itemListElement">
      <a href="https://github.com/mbjoseph/CARstan/issues" class="js-selected-navigation-item reponav-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /mbjoseph/CARstan/issues" itemprop="url">
        <svg aria-hidden="true" class="octicon octicon-issue-opened" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
        <span itemprop="name">Issues</span>
        <span class="Counter">0</span>
        <meta itemprop="position" content="2">
</a>    </span>

  <span itemscope="" itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a href="https://github.com/mbjoseph/CARstan/pulls" class="js-selected-navigation-item reponav-item" data-hotkey="g p" data-selected-links="repo_pulls /mbjoseph/CARstan/pulls" itemprop="url">
      <svg aria-hidden="true" class="octicon octicon-git-pull-request" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
      <span itemprop="name">Pull requests</span>
      <span class="Counter">0</span>
      <meta itemprop="position" content="3">
</a>  </span>

    <a href="https://github.com/mbjoseph/CARstan/projects" class="js-selected-navigation-item reponav-item" data-selected-links="repo_projects new_repo_project repo_project /mbjoseph/CARstan/projects">
      <svg aria-hidden="true" class="octicon octicon-project" height="16" version="1.1" viewBox="0 0 15 16" width="15"><path fill-rule="evenodd" d="M10 12h3V2h-3v10zm-4-2h3V2H6v8zm-4 4h3V2H2v12zm-1 1h13V1H1v14zM14 0H1a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"></path></svg>
      Projects
      <span class="Counter">0</span>
</a>


    <div class="reponav-dropdown js-menu-container">
      <button type="button" class="btn-link reponav-item reponav-dropdown js-menu-target " data-no-toggle="" aria-expanded="false" aria-haspopup="true">
        Insights
        <svg aria-hidden="true" class="octicon octicon-triangle-down v-align-middle text-gray" height="11" version="1.1" viewBox="0 0 12 16" width="8"><path fill-rule="evenodd" d="M0 5l6 6 6-6z"></path></svg>
      </button>
      <div class="dropdown-menu-content js-menu-content">
        <div class="dropdown-menu dropdown-menu-sw">
          <a class="dropdown-item" href="https://github.com/mbjoseph/CARstan/pulse" data-skip-pjax="">
            <svg aria-hidden="true" class="octicon octicon-pulse" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M11.5 8L8.8 5.4 6.6 8.5 5.5 1.6 2.38 8H0v2h3.6l.9-1.8.9 5.4L9 8.5l1.6 1.5H14V8z"></path></svg>
            Pulse
          </a>
          <a class="dropdown-item" href="https://github.com/mbjoseph/CARstan/graphs" data-skip-pjax="">
            <svg aria-hidden="true" class="octicon octicon-graph" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M16 14v1H0V0h1v14h15zM5 13H3V8h2v5zm4 0H7V3h2v10zm4 0h-2V6h2v7z"></path></svg>
            Graphs
          </a>
        </div>
      </div>
    </div>
</nav>

      </div>
    </div>

<div class="container new-discussion-timeline experiment-repo-nav">
  <div class="repository-content">

    
      <div class="signup-prompt-bg rounded-1">
      <div class="signup-prompt p-4 text-center mb-4 rounded-1">
        <div class="position-relative">
          <!-- '"` --><!-- </textarea></xmp> --><form accept-charset="UTF-8" action="/site/dismiss_signup_prompt" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" value="✓" type="hidden"><input name="authenticity_token" value="TwNPPJvHhrUWGu2eXQG1RtgZJrzG35y7dPGQx91s0lCq3i1D5W3ze/zYn94iqNtOBYiwFQ9KBAlrECrYIe3d8w==" type="hidden"></div>
            <button type="submit" class="position-absolute top-0 right-0 btn-link link-gray" data-ga-click="(Logged out) Sign up prompt, clicked Dismiss, text:dismiss">
              Dismiss
            </button>
</form>
          <h3 class="pt-2">Join GitHub today</h3>
          <p class="col-6 mx-auto">GitHub is home to over 20 million 
developers working together to host and review code, manage projects, 
and build software together.</p>
          <p class="pb-2">
            <a class="btn btn-blue" href="https://github.com/join?source=prompt-code" data-ga-click="(Logged out) Sign up prompt, clicked Sign up, text:sign-up">Sign up</a>
          </p>
        </div>
      </div>
    </div>


  <div class="js-repo-meta-container">
  <div class="repository-meta mb-0 mb-3 js-repo-meta-edit js-details-container">
    <div class="repository-meta-content col-11 mb-1">
          <span class="col-11 text-gray-dark mr-2" itemprop="about">
            Conditional autoregressive models in Stan
          </span>
    </div>

  </div>

</div>



  <div class="overall-summary overall-summary-bottomless">
    <div class="stats-switcher-viewport js-stats-switcher-viewport">
      <div class="stats-switcher-wrapper">
      <ul class="numbers-summary">
        <li class="commits">
          <a data-pjax="" href="https://github.com/mbjoseph/CARstan/commits/master">
              <svg aria-hidden="true" class="octicon octicon-history" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M8 13H6V6h5v2H8v5zM7 1C4.81 1 2.87 2.02 1.59 3.59L0 2v4h4L2.5 4.5C3.55 3.17 5.17 2.3 7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-.34.03-.67.09-1H.08C.03 7.33 0 7.66 0 8c0 3.86 3.14 7 7 7s7-3.14 7-7-3.14-7-7-7z"></path></svg>
              <span class="num text-emphasized">
                12
              </span>
              commits
          </a>
        </li>
        <li>
          <a data-pjax="" href="https://github.com/mbjoseph/CARstan/branches">
            <svg aria-hidden="true" class="octicon octicon-git-branch" height="16" version="1.1" viewBox="0 0 10 16" width="10"><path fill-rule="evenodd" d="M10 5c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v.3c-.02.52-.23.98-.63 1.38-.4.4-.86.61-1.38.63-.83.02-1.48.16-2 .45V4.72a1.993 1.993 0 0 0-1-3.72C.88 1 0 1.89 0 3a2 2 0 0 0 1 1.72v6.56c-.59.35-1 .99-1 1.72 0 1.11.89 2 2 2 1.11 0 2-.89 2-2 0-.53-.2-1-.53-1.36.09-.06.48-.41.59-.47.25-.11.56-.17.94-.17 1.05-.05 1.95-.45 2.75-1.25S8.95 7.77 9 6.73h-.02C9.59 6.37 10 5.73 10 5zM2 1.8c.66 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2C1.35 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2zm0 12.41c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm6-8c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
            <span class="num text-emphasized">
              1
            </span>
            branch
          </a>
        </li>

        <li>
          <a href="https://github.com/mbjoseph/CARstan/releases">
            <svg aria-hidden="true" class="octicon octicon-tag" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 0 0 0-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"></path></svg>
            <span class="num text-emphasized">
              1
            </span>
            release
          </a>
        </li>

        <li>
            <a href="https://github.com/mbjoseph/CARstan/graphs/contributors">
  <svg aria-hidden="true" class="octicon octicon-organization" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M16 12.999c0 .439-.45 1-1 1H7.995c-.539 0-.994-.447-.995-.999H1c-.54 0-1-.561-1-1 0-2.634 3-4 3-4s.229-.409 0-1c-.841-.621-1.058-.59-1-3 .058-2.419 1.367-3 2.5-3s2.442.58 2.5 3c.058 2.41-.159 2.379-1 3-.229.59 0 1 0 1s1.549.711 2.42 2.088C9.196 9.369 10 8.999 10 8.999s.229-.409 0-1c-.841-.62-1.058-.59-1-3 .058-2.419 1.367-3 2.5-3s2.437.581 2.495 3c.059 2.41-.158 2.38-1 3-.229.59 0 1 0 1s3.005 1.366 3.005 4"></path></svg>
    <span class="num text-emphasized">
      1
    </span>
    contributor
</a>
        </li>
          <li>
            <a href="https://github.com/mbjoseph/CARstan/blob/master/LICENSE">
              <svg aria-hidden="true" class="octicon octicon-law" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M7 4c-.83 0-1.5-.67-1.5-1.5S6.17 1 7 1s1.5.67 1.5 1.5S7.83 4 7 4zm7 6c0 1.11-.89 2-2 2h-1c-1.11 0-2-.89-2-2l2-4h-1c-.55 0-1-.45-1-1H8v8c.42 0 1 .45 1 1h1c.42 0 1 .45 1 1H3c0-.55.58-1 1-1h1c0-.55.58-1 1-1h.03L6 5H5c0 .55-.45 1-1 1H3l2 4c0 1.11-.89 2-2 2H2c-1.11 0-2-.89-2-2l2-4H1V5h3c0-.55.45-1 1-1h4c.55 0 1 .45 1 1h3v1h-1l2 4zM2.5 7L1 10h3L2.5 7zM13 10l-1.5-3-1.5 3h3z"></path></svg>
                BSD-3-Clause
            </a>
          </li>
      </ul>

        <div class="repository-lang-stats">
          <ol class="repository-lang-stats-numbers">
            <li>
                <a href="https://github.com/mbjoseph/CARstan/search?l=stan" data-ga-click="Repository, language stats search click, location:repo overview">
                  <span class="color-block language-color" style="background-color:#b2011d;"></span>
                  <span class="lang">Stan</span>
                  <span class="percent">100.0%</span>
                </a>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>

    <div class="repository-lang-stats-graph js-toggle-lang-stats" title="Click for language details" data-ga-click="Repository, language bar stats toggle, location:repo overview">
      <span class="language-color" aria-label="Stan 100.0%" style="width:100.0%; background-color:#b2011d;" itemprop="keywords">Stan</span>
    </div>


  <div class="file-navigation in-mid-page">

    <div class="select-menu get-repo-select-menu js-menu-container float-right select-menu-modal-right">
  <button class="btn btn-sm btn-primary select-menu-button js-menu-target" type="button" aria-label="Clone or download this repository" aria-expanded="false" aria-haspopup="true">
    <span>Clone or download</span>
  </button>

  <div class="select-menu-modal-holder dropdown-menu-content js-menu-content">
    <div class="get-repo-modal dropdown-menu dropdown-menu-sw pb-0 js-toggler-container ">
      <div class="clone-options https-clone-options">

        <h4 class="mb-1">
          Clone with HTTPS
          <a class="muted-link" href="https://help.github.com/articles/which-remote-url-should-i-use" target="_blank" title="Which remote URL should I use?">
            <svg aria-hidden="true" class="octicon octicon-question" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M6 10h2v2H6v-2zm4-3.5C10 8.64 8 9 8 9H6c0-.55.45-1 1-1h.5c.28 0 .5-.22.5-.5v-1c0-.28-.22-.5-.5-.5h-1c-.28 0-.5.22-.5.5V7H4c0-1.5 1.5-3 3-3s3 1 3 2.5zM7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7z"></path></svg>
          </a>
        </h4>
        <p class="mb-2 get-repo-decription-text">
          Use Git or checkout with SVN using the web URL.
        </p>

        <div class="input-group js-zeroclipboard-container">
  <input class="form-control input-monospace input-sm js-zeroclipboard-target js-url-field" value="https://github.com/mbjoseph/CARstan.git" aria-label="Clone this repository at https://github.com/mbjoseph/CARstan.git" readonly="readonly" type="text">
  <div class="input-group-button">
    <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button"><svg aria-hidden="true" class="octicon octicon-clippy" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M2 13h4v1H2v-1zm5-6H2v1h5V7zm2 3V8l-3 3 3 3v-2h5v-2H9zM4.5 9H2v1h2.5V9zM2 12h2.5v-1H2v1zm9 1h1v2c-.02.28-.11.52-.3.7-.19.18-.42.28-.7.3H1c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h3c0-1.11.89-2 2-2 1.11 0 2 .89 2 2h3c.55 0 1 .45 1 1v5h-1V6H1v9h10v-2zM2 5h8c0-.55-.45-1-1-1H8c-.55 0-1-.45-1-1s-.45-1-1-1-1 .45-1 1-.45 1-1 1H3c-.55 0-1 .45-1 1z"></path></svg></button>
  </div>
</div>

      </div>


      <div class="mt-2">
          <a href="https://desktop.github.com/" class="btn btn-outline get-repo-btn tooltipped tooltipped-s tooltipped-multiline" aria-label="Clone mbjoseph/CARstan to your computer and use it in GitHub Desktop.">
    Open in Desktop
  </a>

<a href="https://github.com/mbjoseph/CARstan/archive/master.zip" class="btn btn-outline get-repo-btn
" rel="nofollow" data-ga-click="Repository, download zip, location:repo overview">
  Download ZIP
</a>

      </div>
    </div>
  </div>
</div>


  <div class="BtnGroup float-right">

    <a href="https://github.com/mbjoseph/CARstan/find/master" class="btn btn-sm empty-icon float-right BtnGroup-item" data-pjax="" data-hotkey="t" data-ga-click="Repository, find file, location:repo overview">
      Find file
    </a>
  </div>

  
<div class="select-menu branch-select-menu js-menu-container js-select-menu float-left">
  <button class=" btn btn-sm select-menu-button js-menu-target css-truncate" data-hotkey="w" type="button" aria-label="Switch branches or tags" aria-expanded="false" aria-haspopup="true">
      <i>Branch:</i>
      <span class="js-select-button css-truncate-target">master</span>
  </button>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax="">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <svg aria-label="Close" class="octicon octicon-x js-menu-close" height="16" role="img" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
        <span class="select-menu-title">Switch branches/tags</span>
      </div>

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input aria-label="Filter branches/tags" id="context-commitish-filter-field" class="form-control js-filterable-field js-navigation-enable" placeholder="Filter branches/tags" type="text">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" data-filter-placeholder="Filter branches/tags" class="js-select-menu-tab" role="tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" data-filter-placeholder="Find a tag…" class="js-select-menu-tab" role="tab">Tags</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches" role="menu">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open selected" href="https://github.com/mbjoseph/CARstan/tree/master" data-name="master" data-skip-pjax="true" rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text">
                master
              </span>
            </a>
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open " href="https://github.com/mbjoseph/CARstan/tree/v1.0.0" data-name="v1.0.0" data-skip-pjax="true" rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.0.0">
                v1.0.0
              </span>
            </a>
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div>

    </div>
  </div>
</div>


      <button type="button" class="btn btn-sm disabled tooltipped tooltipped-n new-pull-request-btn" aria-label="You must be signed in to create a pull request">
        New pull request
      </button>

  <div class="breadcrumb">
    
  </div>
</div>


  


  <div class="commit-tease js-details-container Details">
    <span class="float-right">
      Latest commit
      <a class="commit-tease-sha" href="https://github.com/mbjoseph/CARstan/commit/944501e704724039b8ef31318bc1979512a1149a" data-pjax="">
        944501e
      </a>
      <span itemprop="dateModified"><relative-time datetime="2017-02-09T18:28:38Z" title="2017年2月10日 GMT+8 上午2:28">on 10 Feb</relative-time></span>
    </span>


    <span class="commit-author-section">
      <img alt="@mbjoseph" class="avatar" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/2664564.jpg" width="20" height="20">
      <a href="https://github.com/mbjoseph" class="user-mention" rel="author">mbjoseph</a>
    </span>

        <a href="https://github.com/mbjoseph/CARstan/commit/944501e704724039b8ef31318bc1979512a1149a" class="message" data-pjax="true" title="adding Dockerfile and chunk names">adding Dockerfile and chunk names</a>
    

  </div>





<div class="file-wrap">

  <a href="https://github.com/mbjoseph/CARstan/tree/944501e704724039b8ef31318bc1979512a1149a" class="d-none js-permalink-shortcut" data-hotkey="y">Permalink</a>

  <table class="files js-navigation-container js-active-navigation-container" data-pjax="">


    <tbody>
      <tr class="warning include-fragment-error">
        <td class="icon"><svg aria-hidden="true" class="octicon octicon-alert" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg></td>
        <td class="content" colspan="3">Failed to load latest commit information.</td>
      </tr>

        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-directory" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/tree/master/README_files/figure-html" class="js-navigation-open" id="3c18e10ab93c3c52de9b7ad09ef6c569-42778bdbb7007ead9a3785725a24a6c7151d0358" title="This path skips through empty directories"><span class="simplified-path">README_files/</span>figure-html</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/944501e704724039b8ef31318bc1979512a1149a" class="message" data-pjax="true" title="adding Dockerfile and chunk names">adding Dockerfile and chunk names</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-09T18:28:38Z" title="2017年2月10日 GMT+8 上午2:28">5 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-directory" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/tree/master/data" class="js-navigation-open" id="8d777f385d3dfec8815d20f7496026dc-cc60f43f15f21b19aa6feb547982a577e3369028" title="data">data</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/867e595823ecdb992b1558d38e5d9033ca958f46" class="message" data-pjax="true" title="using new projection for map, better priors for tau, and bundling the sparse CAR prior into a function">using new projection for map, better priors for tau, and bundling the…</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-05T14:49:13Z" title="2016年9月5日 GMT+8 下午10:49">10 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-directory" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M13 4H7V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM6 4H1V3h5v1z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/tree/master/stan" class="js-navigation-open" id="f52412c4ff1dacd2111f4951f3db1260-36f9970ec5a67c15358eb64506c41cc997920479" title="stan">stan</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/f62a539f552d0be4048827511d4ab803448373f9" class="message" data-pjax="true" title="Fixed the intrinsic model to make the dimension of the prior correct">Fixed the intrinsic model to make the dimension of the prior correct</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-19T20:23:06Z" title="2016年9月20日 GMT+8 上午4:23">10 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/blob/master/.gitignore" class="js-navigation-open" id="a084b794bc0759e7a6b77810e01874f2-dfd68d70057c3903650496f6ac13c978a0eb3eb4" title=".gitignore">.gitignore</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/944501e704724039b8ef31318bc1979512a1149a" class="message" data-pjax="true" title="adding Dockerfile and chunk names">adding Dockerfile and chunk names</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-09T18:28:38Z" title="2017年2月10日 GMT+8 上午2:28">5 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/blob/master/CARstan.Rproj" class="js-navigation-open" id="65f3fe626b00bcaa0ab0fe894956931a-a21310892843662e12957f5246267f97f7e422c2" title="CARstan.Rproj">CARstan.Rproj</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/aff7d309e69883741d11f5c086d62970728ba878" class="message" data-pjax="true" title="first commit">first commit</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-08-21T16:13:16Z" title="2016年8月22日 GMT+8 上午12:13">11 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/blob/master/Dockerfile" class="js-navigation-open" id="3254677a7917c6c01f55212f86c57fbf-dc667b9f121ab8c9118f93939f478c4e7845e141" title="Dockerfile">Dockerfile</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/944501e704724039b8ef31318bc1979512a1149a" class="message" data-pjax="true" title="adding Dockerfile and chunk names">adding Dockerfile and chunk names</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-09T18:28:38Z" title="2017年2月10日 GMT+8 上午2:28">5 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/blob/master/LICENSE" class="js-navigation-open" id="9879d6db96fd29134fc802214163b95a-90878ba38d89f56080814b10ca3bce39cee9ad7c" itemprop="license" title="LICENSE">LICENSE</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/1d72ab92ef7d1ae451a2b1dc7538e7d9bab0d599" class="message" data-pjax="true" title="moving to BSD license">moving to BSD license</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-01T22:26:39Z" title="2016年9月2日 GMT+8 上午6:26">11 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/blob/master/README.Rmd" class="js-navigation-open" id="5140cd39fa2897e01ffbfb8db0999940-c2de775b35baedcdfb2a11fdeb9ebbf26dd52197" title="README.Rmd">README.Rmd</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/944501e704724039b8ef31318bc1979512a1149a" class="message" data-pjax="true" title="adding Dockerfile and chunk names">adding Dockerfile and chunk names</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-09T18:28:38Z" title="2017年2月10日 GMT+8 上午2:28">5 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/blob/master/README.md" class="js-navigation-open" id="04c6e90faac2675aa89e2176d2eec7d8-8d64522406999577701c996542bd8e765c3d05f3" title="README.md">README.md</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/944501e704724039b8ef31318bc1979512a1149a" class="message" data-pjax="true" title="adding Dockerfile and chunk names">adding Dockerfile and chunk names</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2017-02-09T18:28:38Z" title="2017年2月10日 GMT+8 上午2:28">5 months ago</time-ago></span>
          </td>
        </tr>
        <tr class="js-navigation-item navigation-focus">
          <td class="icon">
            <svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg>
            <img alt="" class="spinner" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/octocat-spinner-32.gif" width="16" height="16">
          </td>
          <td class="content">
            <span class="css-truncate css-truncate-target"><a href="https://github.com/mbjoseph/CARstan/blob/master/blogpost.md" class="js-navigation-open" id="630433e5cb9b1be202973053499da225-a5f9690d134f5c8edacc16686edaeb260cc8c892" title="blogpost.md">blogpost.md</a></span>
          </td>
          <td class="message">
            <span class="css-truncate css-truncate-target">
                  <a href="https://github.com/mbjoseph/CARstan/commit/428d8f1cc8220f78629f48768d551b1609190fe1" class="message" data-pjax="true" title="adding a blogpost and ignoring any generated html from it">adding a blogpost and ignoring any generated html from it</a>
            </span>
          </td>
          <td class="age">
            <span class="css-truncate css-truncate-target"><time-ago datetime="2016-09-02T02:10:28Z" title="2016年9月2日 GMT+8 上午10:10">11 months ago</time-ago></span>
          </td>
        </tr>
    </tbody>
  </table>

</div>





  <div id="readme" class="readme boxed-group clearfix announce instapaper_body md">
    <h3>
      <svg aria-hidden="true" class="octicon octicon-book" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M3 5h4v1H3V5zm0 3h4V7H3v1zm0 2h4V9H3v1zm11-5h-4v1h4V5zm0 2h-4v1h4V7zm0 2h-4v1h4V9zm2-6v9c0 .55-.45 1-1 1H9.5l-1 1-1-1H2c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h5.5l1 1 1-1H15c.55 0 1 .45 1 1zm-8 .5L7.5 3H2v9h6V3.5zm7-.5H9.5l-.5.5V12h6V3z"></path></svg>
      README.md
    </h3>

      <article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-exact-sparse-car-models-in-stan" class="anchor" href="#exact-sparse-car-models-in-stan" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exact sparse CAR models in Stan</h1>
<p>Max Joseph<br>
August 20, 2016</p>
<p>This document details sparse exact conditional autoregressive (CAR) 
models in Stan as an extension of previous work on approximate sparse 
CAR models in Stan.
Sparse representations seem to give order of magnitude efficiency gains,
 scaling better for large spatial data sets.</p>
<h2><a id="user-content-car-priors-for-spatial-random-effects" class="anchor" href="#car-priors-for-spatial-random-effects" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CAR priors for spatial random effects</h2>
<p>Conditional autoregressive (CAR) models are popular as prior 
distributions for spatial random effects with areal spatial data.
If we have a random quantity $\phi = (\phi_1, \phi_2, ..., \phi_n)'$ at 
$n$ areal locations, the CAR model is often expressed via full 
conditional distributions:</p>
<p>$$\phi_i \mid \phi_j, j \neq i \sim N(\alpha \sum_{j = 1}^n b_{ij} \phi_j, \tau_i^{-1})$$</p>
<p>where $\tau_i$ is a spatially varying precision parameter, and $b_{ii} = 0$.</p>
<p>By Brook's Lemma, the joint distribution of $\phi$ is then:</p>
<p>$$\phi \sim N(0, [D_\tau (I - \alpha B)]^{-1}).$$</p>
<p>If we assume the following:</p>
<ul>
<li>$D_\tau = \tau D$</li>
<li>$D = diag(m_i)$: an $n \times n$ diagonal matrix with $m_i$ = the number of neighbors for location $i$</li>
<li>$I$: an $n \times n$ identity matrix</li>
<li>$\alpha$: a parameter that controls spatial dependence ($\alpha = 0$
 implies spatial independence, and $\alpha = 1$ collapses to an <em>intrisnic conditional autoregressive</em> (IAR) specification)</li>
<li>$B = D^{-1} W$: the scaled adjacency matrix</li>
<li>$W$: the adjacency matrix ($w_{ii} = 0, w_{ij} = 1$ if $i$ is a neighbor of $j$, and $w_{ij}=0$ otherwise)</li>
</ul>
<p>then the CAR prior specification simplifies to:</p>
<p>$$\phi \sim N(0, [\tau (D - \alpha W)]^{-1}).$$</p>
<p>The $\alpha$ parameter ensures propriety of the joint distrbution of 
$\phi$ as long as $| \alpha | &lt; 1$ (Gelfand &amp; Vounatsou 2003).
However, $\alpha$ is often taken as 1, leading to the IAR specification 
which creates a singular precision matrix and an improper prior 
distribution.</p>
<h2><a id="user-content-a-poisson-specification" class="anchor" href="#a-poisson-specification" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Poisson specification</h2>
<p>Suppose we have aggregated count data $y_1, y_2, ..., y_n$ at $n$ 
locations, and we expect that neighboring locations will have similar 
counts.
With a Poisson likelihood:</p>
<p>$$y_i \sim \text{Poisson}(\text{exp}(X_{i} \beta + \phi_i + \log(\text{offset}_i)))$$</p>
<p>where $X_i$ is a design vector (the $i^{th}$ row from a design 
matrix), $\beta$ is a vector of coefficients, $\phi_i$ is a spatial 
adjustment, and $\log(\text{offset}_i)$ accounts for differences in 
expected values or exposures at the spatial units (popular choices 
include area for physical processes, or population size for disease 
applications).</p>
<p>If we specify a proper CAR prior for $\phi$, then we have that $\phi 
\sim \text{N}(0, [\tau (D - \alpha W)]^{-1})$ where $\tau (D - \alpha 
W)$ is the precision matrix $\Sigma^{-1}$.
A complete Bayesian specification would include priors for the remaining
 parameters $\alpha$, $\tau$, and $\beta$, such that our posterior 
distribution is:</p>
<p>$$p(\phi, \beta, \alpha, \tau \mid y) \propto p(y \mid \beta, \phi) p(\phi \mid \alpha, \tau) p(\alpha) p(\tau) p(\beta)$$</p>
<h2><a id="user-content-example-scottish-lip-cancer-data" class="anchor" href="#example-scottish-lip-cancer-data" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Scottish lip cancer data</h2>
<p>To demonstrate this approach we'll use the Scottish lip cancer data example (some documentation <a href="https://cran.r-project.org/web/packages/CARBayesdata/CARBayesdata.pdf">here</a>).
This
 data set includes observed lip cancer case counts at 56 spatial units 
in Scotland, with an expected number of cases to be used as an offset, 
and an area-specific continuous covariate that represents the proportion
 of the population employed in agriculture, fishing, or forestry.
The model structure is identical to the Poisson model outlined above.</p>
<pre><code>## Warning in gpclibPermit(): support for gpclib will be withdrawn from
## maptools at the next major release
</code></pre>
<pre><code>## [1] TRUE
</code></pre>
<p><a href="https://github.com/mbjoseph/CARstan/blob/master/README_files/figure-html/make-scotland-map-1.png" target="_blank"><img src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/make-scotland-map-1.png" alt="" style="max-width:100%;"></a></p>
<p>Let's start by loading packages and data, specifying the number of MCMC iterations and chains.</p>
<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">ggmcmc</span>)
library(<span class="pl-smi">rstan</span>)
rstan_options(<span class="pl-v">auto_write</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
options(<span class="pl-v">mc.cores</span> <span class="pl-k">=</span> <span class="pl-e">parallel</span><span class="pl-k">::</span>detectCores())
source(<span class="pl-s"><span class="pl-pds">'</span>data/scotland_lip_cancer.RData<span class="pl-pds">'</span></span>)

<span class="pl-c"><span class="pl-c">#</span> Define MCMC parameters </span>
<span class="pl-smi">niter</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">1E4</span>   <span class="pl-c"><span class="pl-c">#</span> definitely overkill, but good for comparison</span>
<span class="pl-smi">nchains</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">4</span></pre></div>
<p>To fit the full model, we'll pull objects loaded with our Scotland lip cancer data.
I'll use <code>model.matrix</code> to generate a design matrix, centering and scaling the continuous covariate <code>x</code> to reduce correlation between the intercept and slope estimates.</p>
<div class="highlight highlight-source-r"><pre><span class="pl-smi">W</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">A</span> <span class="pl-c"><span class="pl-c">#</span> adjacency matrix</span>
<span class="pl-smi">scaled_x</span> <span class="pl-k">&lt;-</span> c(scale(<span class="pl-smi">x</span>))
<span class="pl-smi">X</span> <span class="pl-k">&lt;-</span> model.matrix(<span class="pl-k">~</span><span class="pl-smi">scaled_x</span>)
  
<span class="pl-smi">full_d</span> <span class="pl-k">&lt;-</span> <span class="pl-k">list</span>(<span class="pl-v">n</span> <span class="pl-k">=</span> nrow(<span class="pl-smi">X</span>),         <span class="pl-c"><span class="pl-c">#</span> number of observations</span>
               <span class="pl-v">p</span> <span class="pl-k">=</span> ncol(<span class="pl-smi">X</span>),         <span class="pl-c"><span class="pl-c">#</span> number of coefficients</span>
               <span class="pl-v">X</span> <span class="pl-k">=</span> <span class="pl-smi">X</span>,               <span class="pl-c"><span class="pl-c">#</span> design matrix</span>
               <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">O</span>,               <span class="pl-c"><span class="pl-c">#</span> observed number of cases</span>
               <span class="pl-v">log_offset</span> <span class="pl-k">=</span> log(<span class="pl-smi">E</span>), <span class="pl-c"><span class="pl-c">#</span> log(expected) num. cases</span>
               <span class="pl-v">W</span> <span class="pl-k">=</span> <span class="pl-smi">W</span>)               <span class="pl-c"><span class="pl-c">#</span> adjacency matrix</span></pre></div>
<h4><a id="user-content-stan-implementation-car-with-multi_normal_prec" class="anchor" href="#stan-implementation-car-with-multi_normal_prec" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stan implementation: CAR with <code>multi_normal_prec</code></h4>
<p>Our model statement mirrors the structure outlined above, with 
explicit normal and gamma priors on $\beta$ and $\tau$ respectively, and
 a $\text{Uniform}(0, 1)$ prior for $\alpha$.
The prior on $\phi$ is specified via the <code>multi_normal_prec</code> function, passing in $\tau (D - \alpha W)$ as the precision matrix.</p>
<pre><code>data {
  int&lt;lower = 1&gt; n;
  int&lt;lower = 1&gt; p;
  matrix[n, p] X;
  int&lt;lower = 0&gt; y[n];
  vector[n] log_offset;
  matrix&lt;lower = 0, upper = 1&gt;[n, n] W;
}
transformed data{
  vector[n] zeros;
  matrix&lt;lower = 0&gt;[n, n] D;
  {
    vector[n] W_rowsums;
    for (i in 1:n) {
      W_rowsums[i] = sum(W[i, ]);
    }
    D = diag_matrix(W_rowsums);
  }
  zeros = rep_vector(0, n);
}
parameters {
  vector[p] beta;
  vector[n] phi;
  real&lt;lower = 0&gt; tau;
  real&lt;lower = 0, upper = 1&gt; alpha;
}
model {
  phi ~ multi_normal_prec(zeros, tau * (D - alpha * W));
  beta ~ normal(0, 1);
  tau ~ gamma(2, 2);
  y ~ poisson_log(X * beta + phi + log_offset);
}
</code></pre>
<p>Fitting the model with <code>rstan</code>:</p>
<div class="highlight highlight-source-r"><pre><span class="pl-smi">full_fit</span> <span class="pl-k">&lt;-</span> stan(<span class="pl-s"><span class="pl-pds">'</span>stan/car_prec.stan<span class="pl-pds">'</span></span>, <span class="pl-v">data</span> <span class="pl-k">=</span> <span class="pl-smi">full_d</span>, 
                 <span class="pl-v">iter</span> <span class="pl-k">=</span> <span class="pl-smi">niter</span>, <span class="pl-v">chains</span> <span class="pl-k">=</span> <span class="pl-smi">nchains</span>, <span class="pl-v">verbose</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)
print(<span class="pl-smi">full_fit</span>, <span class="pl-v">pars</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">'</span>beta<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>tau<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>alpha<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>lp__<span class="pl-pds">'</span></span>))</pre></div>
<pre><code>## Inference for Stan model: car_prec.
## 4 chains, each with iter=10000; warmup=5000; thin=1; 
## post-warmup draws per chain=5000, total post-warmup draws=20000.
## 
##           mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
## beta[1]   0.02    0.02 0.29  -0.52  -0.15   0.00   0.16   0.69   321 1.01
## beta[2]   0.27    0.00 0.09   0.08   0.21   0.27   0.34   0.45  3981 1.00
## tau       1.65    0.01 0.50   0.85   1.29   1.59   1.93   2.83  6218 1.00
## alpha     0.93    0.00 0.06   0.77   0.91   0.95   0.98   1.00  3804 1.00
## lp__    820.81    0.10 6.73 806.63 816.45 821.18 825.52 832.99  4485 1.00
## 
## Samples were drawn using NUTS(diag_e) at Thu Feb  9 18:25:48 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
<div class="highlight highlight-source-r"><pre><span class="pl-c"><span class="pl-c">#</span> visualize results </span>
<span class="pl-smi">to_plot</span> <span class="pl-k">&lt;-</span> c(<span class="pl-s"><span class="pl-pds">'</span>beta<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>tau<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>alpha<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>phi[1]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>phi[2]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>phi[3]<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>lp__<span class="pl-pds">'</span></span>)
traceplot(<span class="pl-smi">full_fit</span>, <span class="pl-v">pars</span> <span class="pl-k">=</span> <span class="pl-smi">to_plot</span>)</pre></div>
<p><a href="https://github.com/mbjoseph/CARstan/blob/master/README_files/figure-html/fit-prec-model-1.png" target="_blank"><img src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/fit-prec-model-1.png" alt="" style="max-width:100%;"></a></p>
<h3><a id="user-content-a-more-efficient-sparse-representation" class="anchor" href="#a-more-efficient-sparse-representation" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A more efficient sparse representation</h3>
<p>Although we could specify our multivariate normal prior for $\phi$ directly in Stan via <code>multi_normal_prec</code>,
 as we did above, in this case we will accrue computational efficiency 
gains by manually specifying $p(\phi \mid \tau, \alpha)$ directly via 
the log probability accumulator.
The log probability of $\phi$ is:</p>
<p>$$\log(p(\phi \mid \tau, \alpha)) = - \frac{n}{2} \log(2 \pi) + 
\frac{1}{2} \log(\text{det}( \Sigma^{-1})) - \frac{1}{2} \phi^T 
\Sigma^{-1} \phi$$</p>
<p>In Stan, we only need the log posterior up to an additive constant so we can drop the first term.
Then, substituting  $\tau (D - \alpha W)$ for $\Sigma^{-1}$:</p>
<p>$$\frac{1}{2} \log(\text{det}(\tau (D - \alpha W))) - \frac{1}{2} \phi^T \Sigma^{-1} \phi$$</p>
<p>$$ = \frac{1}{2} \log(\tau ^ n \text{det}(D - \alpha W)) - \frac{1}{2} \phi^T \Sigma^{-1} \phi$$</p>
<p>$$ = \frac{n}{2} \log(\tau) + \frac{1}{2} \log(\text{det}(D - \alpha W)) - \frac{1}{2} \phi^T \Sigma^{-1} \phi$$</p>
<p>There are two ways that we can accrue computational efficiency gains:</p>
<ol>
<li>
<p>Sparse representations of $\Sigma^{-1}$ to expedite computation of 
$\phi^T \Sigma^{-1} \phi$ (this work was done by Kyle foreman 
previously, e.g., <a href="https://groups.google.com/d/topic/stan-users/M7T7EIlyhoo/discussion">https://groups.google.com/d/topic/stan-users/M7T7EIlyhoo/discussion</a>).</p>
</li>
<li>
<p>Efficient computation of the determinant. Jin, Carlin, and Banerjee (2005) show that:</p>
</li>
</ol>
<p>$$\text{det}(D - \alpha W) \propto \prod_{i = 1}^n (1 - \alpha \lambda_i)$$</p>
<p>where $\lambda_1, ..., \lambda_n$ are the eigenvalues of 
$D^{-\frac{1}{2}} W D^{-\frac{1}{2}}$, which can be computed ahead of 
time and passed in as data.
Because we only need the log posterior up to an additive constant, we 
can use this result which is proportional up to some multiplicative 
constant $c$:</p>
<p>$$\frac{n}{2} \log(\tau) + \frac{1}{2} \log(c \prod_{i = 1}^n (1 - \alpha \lambda_i)) - \frac{1}{2} \phi^T \Sigma^{-1} \phi$$</p>
<p>$$= \frac{n}{2} \log(\tau) + \frac{1}{2} \log(c) +  \frac{1}{2} 
\log(\prod_{i = 1}^n (1 - \alpha \lambda_i)) - \frac{1}{2} \phi^T 
\Sigma^{-1} \phi$$</p>
<p>Again dropping additive constants:</p>
<p>$$\frac{n}{2} \log(\tau) + \frac{1}{2} \log(\prod_{i = 1}^n (1 - \alpha \lambda_i)) - \frac{1}{2} \phi^T \Sigma^{-1} \phi$$</p>
<p>$$= \frac{n}{2} \log(\tau) + \frac{1}{2} \sum_{i = 1}^n \log(1 - \alpha \lambda_i) - \frac{1}{2} \phi^T \Sigma^{-1} \phi$$</p>
<h3><a id="user-content-stan-implementation-sparse-car" class="anchor" href="#stan-implementation-sparse-car" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stan implementation: sparse CAR</h3>
<p>In the Stan model statement's <code>transformed data</code> block, we
 compute $\lambda_1, ..., \lambda_n$ (the eigenvalues of 
$D^{-\frac{1}{2}} W D^{-\frac{1}{2}}$), and generate a sparse 
representation for W (<code>Wsparse</code>), which is assumed to be 
symmetric, such that the adjacency relationships can be represented in a
 two column matrix where each row is an adjacency relationship between 
two sites.</p>
<p>The Stan model statement for the sparse implementation never constructs the precision matrix, and does not call any of the <code>multi_normal*</code> functions.
Instead, we use define a <code>sparse_car_lpdf()</code> function and use it in the model block.</p>
<pre><code>functions {
  /**
  * Return the log probability of a proper conditional autoregressive (CAR) prior 
  * with a sparse representation for the adjacency matrix
  *
  * @param phi Vector containing the parameters with a CAR prior
  * @param tau Precision parameter for the CAR prior (real)
  * @param alpha Dependence (usually spatial) parameter for the CAR prior (real)
  * @param W_sparse Sparse representation of adjacency matrix (int array)
  * @param n Length of phi (int)
  * @param W_n Number of adjacent pairs (int)
  * @param D_sparse Number of neighbors for each location (vector)
  * @param lambda Eigenvalues of D^{-1/2}*W*D^{-1/2} (vector)
  *
  * @return Log probability density of CAR prior up to additive constant
  */
  real sparse_car_lpdf(vector phi, real tau, real alpha, 
    int[,] W_sparse, vector D_sparse, vector lambda, int n, int W_n) {
      row_vector[n] phit_D; // phi' * D
      row_vector[n] phit_W; // phi' * W
      vector[n] ldet_terms;
    
      phit_D = (phi .* D_sparse)';
      phit_W = rep_row_vector(0, n);
      for (i in 1:W_n) {
        phit_W[W_sparse[i, 1]] = phit_W[W_sparse[i, 1]] + phi[W_sparse[i, 2]];
        phit_W[W_sparse[i, 2]] = phit_W[W_sparse[i, 2]] + phi[W_sparse[i, 1]];
      }
    
      for (i in 1:n) ldet_terms[i] = log1m(alpha * lambda[i]);
      return 0.5 * (n * log(tau)
                    + sum(ldet_terms)
                    - tau * (phit_D * phi - alpha * (phit_W * phi)));
  }
}
data {
  int&lt;lower = 1&gt; n;
  int&lt;lower = 1&gt; p;
  matrix[n, p] X;
  int&lt;lower = 0&gt; y[n];
  vector[n] log_offset;
  matrix&lt;lower = 0, upper = 1&gt;[n, n] W; // adjacency matrix
  int W_n;                // number of adjacent region pairs
}
transformed data {
  int W_sparse[W_n, 2];   // adjacency pairs
  vector[n] D_sparse;     // diagonal of D (number of neigbors for each site)
  vector[n] lambda;       // eigenvalues of invsqrtD * W * invsqrtD
  
  { // generate sparse representation for W
  int counter;
  counter = 1;
  // loop over upper triangular part of W to identify neighbor pairs
    for (i in 1:(n - 1)) {
      for (j in (i + 1):n) {
        if (W[i, j] == 1) {
          W_sparse[counter, 1] = i;
          W_sparse[counter, 2] = j;
          counter = counter + 1;
        }
      }
    }
  }
  for (i in 1:n) D_sparse[i] = sum(W[i]);
  {
    vector[n] invsqrtD;  
    for (i in 1:n) {
      invsqrtD[i] = 1 / sqrt(D_sparse[i]);
    }
    lambda = eigenvalues_sym(quad_form(W, diag_matrix(invsqrtD)));
  }
}
parameters {
  vector[p] beta;
  vector[n] phi;
  real&lt;lower = 0&gt; tau;
  real&lt;lower = 0, upper = 1&gt; alpha;
}
model {
  phi ~ sparse_car(tau, alpha, W_sparse, D_sparse, lambda, n, W_n);
  beta ~ normal(0, 1);
  tau ~ gamma(2, 2);
  y ~ poisson_log(X * beta + phi + log_offset);
}
</code></pre>
<p>Fitting the model:</p>
<div class="highlight highlight-source-r"><pre><span class="pl-smi">sp_d</span> <span class="pl-k">&lt;-</span> <span class="pl-k">list</span>(<span class="pl-v">n</span> <span class="pl-k">=</span> nrow(<span class="pl-smi">X</span>),         <span class="pl-c"><span class="pl-c">#</span> number of observations</span>
             <span class="pl-v">p</span> <span class="pl-k">=</span> ncol(<span class="pl-smi">X</span>),         <span class="pl-c"><span class="pl-c">#</span> number of coefficients</span>
             <span class="pl-v">X</span> <span class="pl-k">=</span> <span class="pl-smi">X</span>,               <span class="pl-c"><span class="pl-c">#</span> design matrix</span>
             <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-smi">O</span>,               <span class="pl-c"><span class="pl-c">#</span> observed number of cases</span>
             <span class="pl-v">log_offset</span> <span class="pl-k">=</span> log(<span class="pl-smi">E</span>), <span class="pl-c"><span class="pl-c">#</span> log(expected) num. cases</span>
             <span class="pl-v">W_n</span> <span class="pl-k">=</span> sum(<span class="pl-smi">W</span>) <span class="pl-k">/</span> <span class="pl-c1">2</span>,    <span class="pl-c"><span class="pl-c">#</span> number of neighbor pairs</span>
             <span class="pl-v">W</span> <span class="pl-k">=</span> <span class="pl-smi">W</span>)               <span class="pl-c"><span class="pl-c">#</span> adjacency matrix</span>

<span class="pl-smi">sp_fit</span> <span class="pl-k">&lt;-</span> stan(<span class="pl-s"><span class="pl-pds">'</span>stan/car_sparse.stan<span class="pl-pds">'</span></span>, <span class="pl-v">data</span> <span class="pl-k">=</span> <span class="pl-smi">sp_d</span>, 
               <span class="pl-v">iter</span> <span class="pl-k">=</span> <span class="pl-smi">niter</span>, <span class="pl-v">chains</span> <span class="pl-k">=</span> <span class="pl-smi">nchains</span>, <span class="pl-v">verbose</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)

print(<span class="pl-smi">sp_fit</span>, <span class="pl-v">pars</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">'</span>beta<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>tau<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>alpha<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>lp__<span class="pl-pds">'</span></span>))</pre></div>
<pre><code>## Inference for Stan model: car_sparse.
## 4 chains, each with iter=10000; warmup=5000; thin=1; 
## post-warmup draws per chain=5000, total post-warmup draws=20000.
## 
##           mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
## beta[1]  -0.01    0.02 0.29  -0.63  -0.15   0.00   0.15   0.57   140 1.03
## beta[2]   0.27    0.00 0.09   0.09   0.21   0.27   0.34   0.46  4449 1.00
## tau       1.64    0.01 0.50   0.86   1.29   1.58   1.94   2.79  5808 1.00
## alpha     0.93    0.00 0.06   0.76   0.91   0.95   0.97   0.99  3169 1.00
## lp__    782.96    0.10 6.83 768.65 778.50 783.31 787.71 795.26  4418 1.00
## 
## Samples were drawn using NUTS(diag_e) at Thu Feb  9 18:26:06 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
<div class="highlight highlight-source-r"><pre>traceplot(<span class="pl-smi">sp_fit</span>, <span class="pl-v">pars</span> <span class="pl-k">=</span> <span class="pl-smi">to_plot</span>)</pre></div>
<p><a href="https://github.com/mbjoseph/CARstan/blob/master/README_files/figure-html/fit-sparse-model-1.png" target="_blank"><img src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/fit-sparse-model-1.png" alt="" style="max-width:100%;"></a></p>
<h3><a id="user-content-mcmc-efficiency-comparison" class="anchor" href="#mcmc-efficiency-comparison" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MCMC Efficiency comparison</h3>
<p>The main quantity of interest is the effective number of samples per unit time.
Sparsity gives us an order of magnitude or so gains, mostly via reductions in run time.</p>
<p>Model     Number of effective samples   Elapsed time (sec)   Effective samples / sec)</p>
<hr>
<p>full                         4485.084            488.56955                   9.180032
sparse                       4418.415             38.52712                 114.683248</p>
<h3><a id="user-content-posterior-distribution-comparison" class="anchor" href="#posterior-distribution-comparison" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Posterior distribution comparison</h3>
<p>Let's compare the estimates to make sure that we get the same answer 
with both approaches.
In this case, I've used more MCMC iterations than we would typically 
need in to get a better estimate of the tails of each marginal posterior
 distribution so that we can compare the 95% credible intervals among 
the two approaches.</p>
<p><a href="https://github.com/mbjoseph/CARstan/blob/master/README_files/figure-html/compare-parameter-estimates-1.png" target="_blank"><img src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/compare-parameter-estimates-1.png" alt="" style="max-width:100%;"></a></p>
<p><a href="https://github.com/mbjoseph/CARstan/blob/master/README_files/figure-html/unnamed-chunk-1-1.png" target="_blank"><img src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/unnamed-chunk-1-1.png" alt="" style="max-width:100%;"></a></p>
<p>The two approaches give the same answers (more or less, with small differences arising due to MCMC sampling error).</p>
<h2><a id="user-content-postscript-sparse-iar-specification" class="anchor" href="#postscript-sparse-iar-specification" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Postscript: sparse IAR specification</h2>
<p>Although the IAR prior for $\phi$ that results from $\alpha = 1$ is 
improper, it remains popular (Besag, York, and Mollie, 1991).
In practice, these models are typically fit with a sum to zero 
constraints: $\sum_{i\text{ in connected coponent}} \phi_i = 0$ for each
 connected component of the graph. This allows us to interpret both the 
overall mean and the component-wise means.</p>
<p>With $\alpha$ fixed to one, we have:</p>
<p>$$\log(p(\phi \mid \tau)) = - \frac{n}{2} \log(2 \pi) + \frac{1}{2} 
\log(\text{det}^*(\tau (D - W))) - \frac{1}{2} \phi^T \tau (D - W) 
\phi$$</p>
<p>$$ = - \frac{n}{2} \log(2 \pi) + \frac{1}{2} \log(\tau^{n-k} \text{det}^*(D - W)) - \frac{1}{2} \phi^T \tau (D - W) \phi$$</p>
<p>$$ = - \frac{n}{2} \log(2 \pi) + \frac{1}{2} \log(\tau^{n-k}) + 
\frac{1}{2} \log(\text{det}^*(D - W)) - \frac{1}{2} \phi^T \tau (D - W) 
\phi$$</p>
<p>Here $\text{det}^*(A)$ is the generalized determinant of the square 
matrix $A$ defined as the product of its non-zero eigenvalues, and $k$ 
is the number of connected components in the graph. For the Scottish Lip
 Cancer data, there is only one connected component and $k=1$.  The 
reason that we need to use the generalized determinant is that the 
precision matrix is, by definition, singular in intrinsic models as the 
support of the Gaussian distribution is on a subspace with fewer than 
$n$ dimensions.  For the classical ICAR(1) model, we know that the 
directions correpsonding to the zero eigenvalues are exactly the vectors
 that are constant on each connected component of the graph and hence 
$k$ is the number of connected components.</p>
<p>Dropping additive constants, the quantity to increment becomes:</p>
<p>$$ \frac{1}{2} \log(\tau^{n-k}) - \frac{1}{2} \phi^T \tau (D - W) \phi$$</p>
<p>And the corresponding Stan syntax would be:</p>
<pre><code>functions {
  /**
  * Return the log probability of a proper intrinsic autoregressive (IAR) prior 
  * with a sparse representation for the adjacency matrix
  *
  * @param phi Vector containing the parameters with a IAR prior
  * @param tau Precision parameter for the IAR prior (real)
  * @param W_sparse Sparse representation of adjacency matrix (int array)
  * @param n Length of phi (int)
  * @param W_n Number of adjacent pairs (int)
  * @param D_sparse Number of neighbors for each location (vector)
  * @param lambda Eigenvalues of D^{-1/2}*W*D^{-1/2} (vector)
  *
  * @return Log probability density of IAR prior up to additive constant
  */
  real sparse_iar_lpdf(vector phi, real tau,
    int[,] W_sparse, vector D_sparse, vector lambda, int n, int W_n) {
      row_vector[n] phit_D; // phi' * D
      row_vector[n] phit_W; // phi' * W
      vector[n] ldet_terms;
    
      phit_D = (phi .* D_sparse)';
      phit_W = rep_row_vector(0, n);
      for (i in 1:W_n) {
        phit_W[W_sparse[i, 1]] = phit_W[W_sparse[i, 1]] + phi[W_sparse[i, 2]];
        phit_W[W_sparse[i, 2]] = phit_W[W_sparse[i, 2]] + phi[W_sparse[i, 1]];
      }
    
      return 0.5 * ((n-1) * log(tau)
                    - tau * (phit_D * phi - (phit_W * phi)));
  }
}
data {
  int&lt;lower = 1&gt; n;
  int&lt;lower = 1&gt; p;
  matrix[n, p] X;
  int&lt;lower = 0&gt; y[n];
  vector[n] log_offset;
  matrix&lt;lower = 0, upper = 1&gt;[n, n] W; // adjacency matrix
  int W_n;                // number of adjacent region pairs
}
transformed data {
  int W_sparse[W_n, 2];   // adjacency pairs
  vector[n] D_sparse;     // diagonal of D (number of neigbors for each site)
  vector[n] lambda;       // eigenvalues of invsqrtD * W * invsqrtD
  
  { // generate sparse representation for W
  int counter;
  counter = 1;
  // loop over upper triangular part of W to identify neighbor pairs
    for (i in 1:(n - 1)) {
      for (j in (i + 1):n) {
        if (W[i, j] == 1) {
          W_sparse[counter, 1] = i;
          W_sparse[counter, 2] = j;
          counter = counter + 1;
        }
      }
    }
  }
  for (i in 1:n) D_sparse[i] = sum(W[i]);
  {
    vector[n] invsqrtD;  
    for (i in 1:n) {
      invsqrtD[i] = 1 / sqrt(D_sparse[i]);
    }
    lambda = eigenvalues_sym(quad_form(W, diag_matrix(invsqrtD)));
  }
}
parameters {
  vector[p] beta;
  vector[n] phi_unscaled;
  real&lt;lower = 0&gt; tau;
}
transformed parameters {
  vector[n] phi; // brute force centering
  phi = phi_unscaled - mean(phi_unscaled);
}
model {
  phi_unscaled ~ sparse_iar(tau, W_sparse, D_sparse, lambda, n, W_n);
  beta ~ normal(0, 1);
  tau ~ gamma(2, 2);
  y ~ poisson_log(X * beta + phi + log_offset);
}
</code></pre>
<h2><a id="user-content-references" class="anchor" href="#references" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h2>
<p>Besag, Julian, Jeremy York, and Annie Mollié. "Bayesian image 
restoration, with two applications in spatial statistics." Annals of the
 institute of statistical mathematics 43.1 (1991): 1-20.</p>
<p>Gelfand, Alan E., and Penelope Vounatsou. "Proper multivariate 
conditional autoregressive models for spatial data analysis." 
Biostatistics 4.1 (2003): 11-15.</p>
<p>Jin, Xiaoping, Bradley P. Carlin, and Sudipto Banerjee. "Generalized 
hierarchical multivariate CAR models for areal data." Biometrics 61.4 
(2005): 950-961.</p>
</article>
  </div>


  </div>
  <div class="modal-backdrop js-touch-events"></div>
</div>

    </div>
  </div>

  </div>

      
<div class="container site-footer-container">
  <div class="site-footer " role="contentinfo">
    <ul class="site-footer-links float-right">
        <li><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact GitHub</a></li>
      <li><a href="https://developer.github.com/" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li><a href="https://training.github.com/" data-ga-click="Footer, go to training, text:training">Training</a></li>
      <li><a href="https://shop.github.com/" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
        <li><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>

    </ul>

    <a href="https://github.com/" aria-label="Homepage" class="site-footer-mark" title="GitHub">
      <svg aria-hidden="true" class="octicon octicon-mark-github" height="24" version="1.1" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>
    <ul class="site-footer-links">
      <li>© 2017 <span title="0.16952s from unicorn-1202933699-d926b">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
        <li><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
        <li><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
        <li><a href="https://help.github.com/" data-ga-click="Footer, go to help, text:help">Help</a></li>
    </ul>
  </div>
</div>



  <div id="ajax-error-message" class="ajax-error-message flash flash-error">
    <svg aria-hidden="true" class="octicon octicon-alert" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg>
    <button type="button" class="flash-close js-flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
      <svg aria-hidden="true" class="octicon octicon-x" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
    </button>
    You can't perform that action at this time.
  </div>


    
    <script crossorigin="anonymous" integrity="sha256-+Eu4exSWhdHmxvBX7jJPLNSW5nf1o1motduFMxO7g+Y=" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/frameworks-f84bb87b149685d1e6c6f057ee324f2cd496e677f5a359a8b5.js"></script>
    
    <script async="async" crossorigin="anonymous" integrity="sha256-E/o6pQrI+fqafRmPDNE7CQV3XTlEatB20X2PdKmYQ4o=" src="GitHub%20-%20mbjoseph_CARstan%20%20Conditional%20autoregressive%20models%20in%20Stan_files/github-13fa3aa50ac8f9fa9a7d198f0cd13b0905775d39446ad076d17d8f.js"></script>
    
    
    
    
  <div class="js-stale-session-flash stale-session-flash flash flash-warn flash-banner d-none">
    <svg aria-hidden="true" class="octicon octicon-alert" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg>
    <span class="signed-in-tab-flash">You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
    <span class="signed-out-tab-flash">You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
  </div>
  <div class="facebox" id="facebox" style="display:none;">
  <div class="facebox-popup">
    <div class="facebox-content" role="dialog" aria-labelledby="facebox-header" aria-describedby="facebox-description">
    </div>
    <button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">
      <svg aria-hidden="true" class="octicon octicon-x" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
    </button>
  </div>
</div>


  


</body></html>